<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zmiana hasÅ‚a â€” SocialApp</title>

  <!-- Favicon (inline SVG jak na logowaniu) -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="%231877f2"/><stop offset="1" stop-color="%237aa8ff"/></linearGradient></defs><rect rx="14" width="64" height="64" fill="url(%23g)"/><path d="M34 10h-4A18 18 0 0 0 12 28v4a18 18 0 0 0 18 18h4a18 18 0 0 0 18-18v-4A18 18 0 0 0 34 10z" fill="white"/></svg>' />
  <link rel="alternate icon" href="/favicon.ico" />
  <meta name="theme-color" content="#1877f2" />
  <meta name="description" content="Formularz zmiany hasÅ‚a: email, nowe hasÅ‚o, potwierdzenie. Walidacja i integracja z Flask (CSRF, flash)." />

  <!-- Style jak na logowaniu -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
</head>
<body>
  <main class="wrap">

    <section class="card" aria-label="Panel zmiany hasÅ‚a">
      <aside class="visual">
        <a class="brand" href="{{ url_for('reset.reset_password') }}">
          <span class="logo"><svg viewBox="0 0 24 24"><path d="M13.5 2h-3A8.5 8.5 0 0 0 2 10.5v3A8.5 8.5 0 0 0 10.5 22h3A8.5 8.5 0 0 0 22 13.5v-3A8.5 8.5 0 0 0 13.5 2z"/></svg></span>
          <strong>SocialApp</strong>
        </a>
        <h1>Ustaw nowe hasÅ‚o</h1>
        <p>Wpisz adres e-mail, nowe hasÅ‚o i potwierdÅº zmianÄ™.</p>
        <svg class="illus" width="360" height="360" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="100" cy="100" r="80" stroke="white" opacity=".1"/>
          <circle cx="100" cy="100" r="60" stroke="white" opacity=".08"/>
          <circle cx="100" cy="100" r="40" stroke="white" opacity=".06"/>
        </svg>
      </aside>

      <form class="form" id="resetForm" method="POST" action="{{ url_for('reset.reset_password')}}" novalidate>
        <h2>ZmieÅ„ hasÅ‚o</h2>
        <p class="muted">Minimum 6 znakÃ³w, oba pola haseÅ‚ muszÄ… siÄ™ zgadzaÄ‡.</p>

        <div id="formError" class="error" role="alert">Popraw zaznaczone pola (email, hasÅ‚o, potwierdzenie).</div>

        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="field">
          <label for="email">Email</label>
          <div class="input">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2l8 6 8-6"/></svg>
            <input id="email" name="email" type="email" autocomplete="email"
                   placeholder="jan.kowalski@example.com" required
                   value="{{ request.form.get('email','') }}" />
          </div>
        </div>

        <div class="field">
          <label for="PasswordForgot">Nowe hasÅ‚o</label>
          <div class="input">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-6h-1V9a5 5 0 0 0-10 0v2H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-3 0H9V9a3 3 0 0 1 6 0v2z"/></svg>
            <input id="PasswordForgot" name="PasswordForgot" type="password" autocomplete="new-password"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6" />
            <button type="button" id="togglePw1" aria-label="PokaÅ¼/ukryj hasÅ‚o">ğŸ‘ï¸</button>
          </div>
        </div>

        <div class="field">
          <label for="RepeatPassword">PowtÃ³rz hasÅ‚o</label>
          <div class="input">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-6h-1V9a5 5 0 0 0-10 0v2H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-3 0H9V9a3 3 0 0 1 6 0v2z"/></svg>
            <input id="RepeatPassword" name="RepeatPassword" type="password" autocomplete="new-password"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6" />
            <button type="button" id="togglePw2" aria-label="PokaÅ¼/ukryj hasÅ‚o">ğŸ‘ï¸</button>
          </div>
        </div>

        <button class="btn primary block" type="submit">ZmieÅ„ hasÅ‚o</button>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-wrap" aria-live="polite" role="status" style="margin-top:.75rem">
              {% for category, message in messages %}
                {% set bs = 'danger' if category in ['error','danger'] else category %}
                <div class="alert alert-{{ bs }} mb-2">{{ message|safe }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <p class="muted" style="margin-top:8px">
          PamiÄ™tasz juÅ¼ hasÅ‚o?
          <a href="{{ url_for('main.index') }}#login" style="color:var(--accent)">WrÃ³Ä‡ do logowania</a>
        </p>
      </form>
    </section>

    <footer class="page">Â© <span id="year"></span> SocialApp â€¢ Zmiana hasÅ‚a</footer>
  </main>

  <script>
    // Rok w stopce
    document.getElementById('year').textContent = new Date().getFullYear();

    // PokaÅ¼/ukryj hasÅ‚a
    function toggleVisibility(input, btn){
      const t = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', t);
      btn.textContent = (t === 'password') ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
    }
    const pw1 = document.getElementById('PasswordForgot');
    const pw2 = document.getElementById('RepeatPassword');
    document.getElementById('togglePw1').addEventListener('click', () => toggleVisibility(pw1, togglePw1));
    document.getElementById('togglePw2').addEventListener('click', () => toggleVisibility(pw2, togglePw2));

    // Prosta walidacja klienta
    const form = document.getElementById('resetForm');
    const errorBox = document.getElementById('formError');
    form.addEventListener('submit', (e) => {
      errorBox.classList.remove('show');

      const email = form.email.value.trim();
      const pass1 = form.PasswordForgot.value.trim();
      const pass2 = form.RepeatPassword.value.trim();

      const okEmail = /.+@.+\..+/.test(email);
      const okLen = pass1.length >= 6;
      const okMatch = pass1 === pass2;

      if(!(okEmail && okLen && okMatch)) {
        e.preventDefault();
        errorBox.textContent =
          !okEmail ? 'Podaj poprawny adres email.' :
          !okLen   ? 'HasÅ‚o powinno mieÄ‡ co najmniej 6 znakÃ³w.' :
                     'HasÅ‚a muszÄ… byÄ‡ identyczne.';
        errorBox.classList.add('show');
      }
      // JeÅ›li OK â†’ naturalny submit do backendu (POST na ten sam endpoint).
    });
  </script>
</body>
</html>
